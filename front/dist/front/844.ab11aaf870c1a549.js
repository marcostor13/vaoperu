"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[844],{3844:(D,h,o)=>{o.r(h),o.d(h,{ProductModule:()=>B});var d=o(9808),v=o(9812),m=o(655),y=o(8745);class p{constructor(){this.name="",this.profileProviderId="",this.description="",this.images=[],this.price=null,this.isFeatured=!1,this.promotionalPrice=null}}class f{constructor(){this.name=!1,this.images=!1,this.price=!1,this.description=!1}}var e=o(5e3),Z=o(319),T=o(1864),g=o(9783),b=o(1724),M=o(9493),S=o(756),J=o(3957),_=o(5315),C=o(930),c=o(4182),I=o(986),P=o(7307);function x(r,l){if(1&r){const t=e.EpF();e.TgZ(0,"app-product-list",28),e.NdJ("productsEvent",function(s){return e.CHM(t),e.oxw().productListEvent(s)}),e.qZA()}if(2&r){const t=e.oxw();e.Q6J("profileProviderId",t.profileProvider._id)("items",t.items)}}const A=function(r){return{"background-image":r}};function E(r,l){if(1&r){const t=e.EpF();e.TgZ(0,"div",31)(1,"div",32),e.NdJ("click",function(){const n=e.CHM(t).$implicit;return e.oxw(2).removeImage(n)}),e._UZ(2,"i",33),e.qZA()()}if(2&r){const t=l.$implicit,i=e.oxw(2);e.Q6J("ngStyle",e.VKq(1,A,"url("+i.getBlobOrImage(t)+")"))}}function k(r,l){if(1&r&&(e.TgZ(0,"div",29),e.YNc(1,E,3,3,"div",30),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.currentImages)}}function F(r,l){if(1&r){const t=e.EpF();e.TgZ(0,"li",36),e.NdJ("click",function(){const n=e.CHM(t).$implicit;return e.oxw(2).selectCat(n)}),e._uU(1),e.qZA()}if(2&r){const t=l.$implicit;e.xp6(1),e.Oqu(t)}}function N(r,l){if(1&r&&(e.TgZ(0,"ul",34),e.YNc(1,F,2,1,"li",35),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.listCats)}}function Q(r,l){if(1&r){const t=e.EpF();e.TgZ(0,"button",37),e.NdJ("click",function(s){e.CHM(t);const n=e.oxw();return n.confirm(s,n.currentItem)}),e._uU(1,"Eliminar"),e.qZA()}}const u=function(r){return{invalid:r}},L=function(r){return{width:r}},U=[{path:"",component:(()=>{class r{constructor(t,i,s,n,a){this.productService=t,this.general=i,this.confirmationService=s,this.messageService=n,this.profileProviderService=a,this.subs=new y.Y,this.displayModal=!1,this.currentItem=new p,this.invalid=new f,this.listCat=!1,this.listCats=[],this.listCatsTmp=[],this.currentImages=[],this.images=[],this.deleteImages=[]}ngOnInit(){this.getProfileProvider()}getProfileProvider(){this.profileProviderService.get().subscribe(t=>{this.profileProvider=t.data,this.getProducts()},t=>{this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})})}getProducts(){this.subs.add(this.productService.getByProfileProviderId(this.profileProvider._id).subscribe(t=>{var i;this.items=t.data,this.getCategories(t.data),this.getListCategories(),0===(null===(i=t.data)||void 0===i?void 0:i.length)&&this.messageService.add({severity:"success",summary:"Mensaje",detail:"No hay productos disponibles"})},t=>{this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})}))}getListCategories(){this.listCats=this.items.map(t=>{if(t.category)return t.category}),this.listCatsTmp=[...this.listCats]}getCategories(t){this.categories=t.map(i=>{if(i.category)return i.category}),this.categories=[...new Set(this.categories)]}validate(){var t;this.invalid=new f;let i=!1;return this.currentItem.name||(i=!0,this.invalid.name=!0),0===(null===(t=this.currentImages)||void 0===t?void 0:t.length)&&(i=!0,this.invalid.images=!0),i&&this.messageService.add({severity:"error",summary:"Error",detail:"Revise los campos"}),i}reset(){this.currentItem=new p,this.currentImages=[],this.uploadPercent=0}addEdit(t=null){this.listCat=!1,this.currentImages=[],t?(this.currentItem=t,t.images&&t.images.map(i=>{this.currentImages=[...this.currentImages,{file:null,blob:null,url:i}]})):this.reset(),this.displayModal=!0}confirm(t,i){this.confirmationService.confirm({target:t.target,message:"\xbfSeg\xfaro que desea eliminar?",icon:"pi pi-exclamation-triangle",acceptLabel:"S\xed",rejectLabel:"No",accept:()=>{this.preDelete(i)},reject:()=>{}})}add(){this.currentItem.profileProviderId=this.profileProvider._id,this.productService.save(this.currentItem).subscribe(t=>{var i;this.messageService.add({severity:"success",summary:"Mensaje",detail:t.message}),(null===(i=this.currentItem)||void 0===i?void 0:i._id)||this.reset(),this.getProducts()},t=>{this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})})}delete(t){this.currentImages=[],this.subs.add(this.productService.delete(t._id).subscribe(i=>{this.messageService.add({severity:"success",summary:"Mensaje",detail:i.message}),this.currentItem=new p,this.getProducts()},i=>{this.messageService.add({severity:"error",summary:"Error",detail:i.error.message})}))}preDelete(t){return(0,m.mG)(this,void 0,void 0,function*(){t.images?(yield this.general.deleteImages(t.images),this.delete(t)):this.delete(t)})}removeImage(t){t.url&&(this.deleteImages=[...this.deleteImages,t],this.currentItem.images=[...this.currentItem.images.filter(i=>i!==t.url)]),this.currentImages=[...this.currentImages.filter(i=>i.url!==t.url)]}onUpload(t){t.currentFiles.map(i=>{const s=new FileReader;s.readAsDataURL(i),s.onload=()=>{this.currentImages=[...this.currentImages,{file:i,blob:s.result,url:null}]}}),this.images=[]}presave(){var t;return(0,m.mG)(this,void 0,void 0,function*(){if(!this.validate())if(this.general.isLoad(!0),(null===(t=this.deleteImages)||void 0===t?void 0:t.length)>0){const i=[];this.deleteImages.map(n=>{n.url&&i.push(n.url)}),yield this.general.deleteImages(i),this.uploadImages()}else this.uploadImages()})}uploadImages(){var t;if((null===(t=this.currentImages)||void 0===t?void 0:t.length)>0){let i=1;this.currentImages.map(s=>(0,m.mG)(this,void 0,void 0,function*(){var n;if(s.file){const a=yield null===(n=this.general.uploadImage(s.file,"products/"))||void 0===n?void 0:n.toPromise();a&&(this.currentItem.images=[...this.currentItem.images,a])}this.uploadPercent=100*i/this.currentImages.length,i++,i===this.currentImages.length+1&&this.add()}))}else this.add()}getBlobOrImage(t){return t.blob||t.url}productListEvent(t){"edit"===t.function&&this.addEdit(t.data)}showListCat(t){var i;this.items.map(n=>{if(n.category)return n.category}),(null===(i=t.target.value)||void 0===i?void 0:i.length)>0?(this.listCats=[...this.listCatsTmp.filter(n=>(null==n?void 0:n.indexOf(t.target.value))>-1)],this.listCat=!0):(this.listCats=[...this.listCatsTmp],this.listCat=!1)}selectCat(t){this.currentItem.category=t,this.listCat=!1}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(Z.M),e.Y36(T.m),e.Y36(g.YP),e.Y36(g.ez),e.Y36(b.n))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-product"]],decls:35,vars:46,consts:[[1,"d-flex","m-0"],[1,"d-none","d-md-flex"],[1,"flex-1"],[1,"p-4","p-md-5"],[1,"row","m-0","justify-content-between","align-items-center"],[1,"btn2",3,"click"],[1,"pi","pi-plus","mr-2"],[1,"section-products","col-4","p-0"],[3,"profileProviderId","items","productsEvent",4,"ngIf"],["header","",3,"visible","modal","styleClass","baseZIndex","autoZIndex","draggable","resizable","visibleChange"],[1,"col-12","row","m-0","justify-content-center","pb-5"],[1,"row","m-0","p-0","flex-column","col-12","col-md-10"],[1,"row","align-items-center","m-0"],[3,"disabled","ngModel","ngModelChange"],[1,"ml-4"],["type","text",1,"mt-3",3,"ngModel","ngClass","placeholder","keyup.enter","ngModelChange","keyup"],[1,"mt-3",3,"ngClass"],["styleClass","col-12 btn2","mode","basic","accept","image/*","uploadLabel","Subir","cancelLabel","Cancelar","invalidFileSizeMessageDetail","El tama\xf1o m\xe1ximo es {0}.",3,"fileLimit","multiple","maxFileSize","chooseLabel","files","auto","onSelect"],[1,"loading"],["class","row m-0 justify-content-center align-items-center mt-2",4,"ngIf"],["cols","30","rows","5",3,"ngModel","ngClass","placeholder","keyup.enter","ngModelChange"],["type","text",1,"mt-3",3,"ngModel","placeholder","keyup.enter","ngModelChange"],[1,""],["type","text","placeholder","Categor\xeda (Opcional)",1,"mt-3",3,"ngModel","keyup","ngModelChange"],["class","opts list-unstyled pt-2",4,"ngIf"],[1,"btn1","mt-4",3,"click"],["class","btn3 bg-color6 pt-2 pb-2 mt-2",3,"click",4,"ngIf"],[3,"autoZIndex","baseZIndex"],[3,"profileProviderId","items","productsEvent"],[1,"row","m-0","justify-content-center","align-items-center","mt-2"],["class","image-miniature m-2",3,"ngStyle",4,"ngFor","ngForOf"],[1,"image-miniature","m-2",3,"ngStyle"],[1,"delete",3,"click"],[1,"pi","pi-trash","text-white","f-20"],[1,"opts","list-unstyled","pt-2"],["class","border cursor pl-2",3,"click",4,"ngFor","ngForOf"],[1,"border","cursor","pl-2",3,"click"],[1,"btn3","bg-color6","pt-2","pb-2","mt-2",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-menu-provider",1),e.TgZ(2,"div",2),e._UZ(3,"app-header-provider"),e.TgZ(4,"div",3)(5,"div",4)(6,"h4"),e._uU(7,"Productos"),e.qZA(),e.TgZ(8,"button",5),e.NdJ("click",function(){return i.addEdit()}),e._UZ(9,"i",6),e._uU(10," Agregar "),e.qZA()(),e.TgZ(11,"div",7),e.YNc(12,x,1,2,"app-product-list",8),e.qZA()()()(),e.TgZ(13,"p-dialog",9),e.NdJ("visibleChange",function(n){return i.displayModal=n}),e.TgZ(14,"div",10)(15,"div",11)(16,"div",12)(17,"p-inputSwitch",13),e.NdJ("ngModelChange",function(n){return i.currentItem.profileProviderId=n}),e.qZA(),e.TgZ(18,"label",14),e._uU(19,"Destacado"),e.qZA()(),e.TgZ(20,"input",15),e.NdJ("keyup.enter",function(){return i.add()})("ngModelChange",function(n){return i.currentItem.name=n})("keyup",function(){return i.invalid.name=!1}),e.qZA(),e.TgZ(21,"div",16)(22,"p-fileUpload",17),e.NdJ("onSelect",function(n){return i.onUpload(n),i.invalid.images=!1}),e.qZA(),e._UZ(23,"div",18),e.qZA(),e.YNc(24,k,2,1,"div",19),e.TgZ(25,"textarea",20),e.NdJ("keyup.enter",function(){return i.add()})("ngModelChange",function(n){return i.currentItem.description=n}),e.qZA(),e.TgZ(26,"input",15),e.NdJ("keyup.enter",function(){return i.add()})("ngModelChange",function(n){return i.currentItem.price=n})("keyup",function(){return i.invalid.price=!1}),e.qZA(),e.TgZ(27,"input",21),e.NdJ("keyup.enter",function(){return i.add()})("ngModelChange",function(n){return i.currentItem.promotionalPrice=n}),e.qZA(),e.TgZ(28,"div",22)(29,"input",23),e.NdJ("keyup",function(n){return i.showListCat(n)})("ngModelChange",function(n){return i.currentItem.category=n}),e.qZA(),e.YNc(30,N,2,1,"ul",24),e.qZA(),e.TgZ(31,"button",25),e.NdJ("click",function(){return i.presave()}),e._uU(32,"Guardar"),e.qZA(),e.YNc(33,Q,2,0,"button",26),e.qZA()()(),e._UZ(34,"p-confirmPopup",27)),2&t&&(e.xp6(12),e.Q6J("ngIf",(null==i.items?null:i.items.length)>0),e.xp6(1),e.Q6J("visible",i.displayModal)("modal",!0)("styleClass","modalLogin")("baseZIndex",1e4)("autoZIndex",!1)("draggable",!1)("resizable",!1),e.xp6(4),e.Q6J("disabled",!!i.currentItem._id)("ngModel",i.currentItem.profileProviderId),e.xp6(3),e.Q6J("ngModel",i.currentItem.name)("ngClass",e.VKq(36,u,i.invalid.name))("placeholder","Producto"),e.xp6(1),e.Q6J("ngClass",e.VKq(38,u,i.invalid.images)),e.xp6(1),e.Q6J("fileLimit",5)("multiple",!0)("maxFileSize",1e7)("chooseLabel","Subir Im\xe1genes")("files",i.images)("auto",!1),e.xp6(1),e.Akn(e.VKq(40,L,i.uploadPercent+"%")),e.xp6(1),e.Q6J("ngIf",i.currentImages),e.xp6(1),e.Q6J("ngModel",i.currentItem.description)("ngClass",e.VKq(42,u,i.invalid.description))("placeholder","Descripci\xf3n"),e.xp6(1),e.Q6J("ngModel",i.currentItem.price)("ngClass",e.VKq(44,u,i.invalid.price))("placeholder","Precio"),e.xp6(1),e.Q6J("ngModel",i.currentItem.promotionalPrice)("placeholder","Precio promocional"),e.xp6(2),e.Q6J("ngModel",i.currentItem.category),e.xp6(1),e.Q6J("ngIf",i.listCat),e.xp6(3),e.Q6J("ngIf",i.currentItem._id),e.xp6(1),e.Q6J("autoZIndex",!1)("baseZIndex",1000001))},directives:[M.O,S.x,d.O5,J.X,_.V,C.Ql,c.JJ,c.On,c.Fj,d.mk,I.p,d.sg,d.PC,P.P],styles:[".section-products[_ngcontent-%COMP%]{max-width:100%!important}"]}),r})()}];let w=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[v.Bz.forChild(U)],v.Bz]}),r})();var O=o(636),Y=o(7118),j=o(7840),z=o(7773),V=o(8478);let B=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({providers:[g.YP],imports:[[d.ez,w,O.p,Y.S,j.C,_.S,c.u5,z.EV,P.n,I.O,V.f,C.Iu]]}),r})()}}]);