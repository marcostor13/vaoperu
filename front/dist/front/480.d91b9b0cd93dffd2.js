"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[480],{6480:(S,h,o)=>{o.r(h),o.d(h,{AddEditModule:()=>$});var p=o(9808),g=o(9812);class v{constructor(){this._id="",this.name="",this.profileProviderId="",this.description="",this.images=[],this.price=null}}class f{constructor(){this.name=!1,this.profileProviderId=!1,this.description=!1,this.images=!1,this.price=!1}}var e=o(5e3),u=o(1864),_=o(9783),n=o(1460),s=o(1724),m=o(4182),y=o(27),A=o(5315),E=o(907),b=o(7307);const Z=["angularCropper"];function P(r,d){if(1&r&&(e.TgZ(0,"option",27),e._uU(1),e.qZA()),2&r){const t=d.$implicit;e.Q6J("value",t._id),e.xp6(1),e.hij(" ",t.comercialName," ")}}const M=function(r){return{"background-image":r}};function T(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"div",30)(1,"div",31),e.NdJ("click",function(){const a=e.CHM(t).$implicit;return e.oxw(2).removeImage(a)}),e._UZ(2,"i",32),e.qZA()()}if(2&r){const t=d.$implicit,i=e.oxw(2);e.Q6J("ngStyle",e.VKq(1,M,"url("+i.getBlobOrImage(t)+")"))}}function U(r,d){if(1&r&&(e.TgZ(0,"div",28),e.YNc(1,T,3,3,"div",29),e.qZA()),2&r){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.currentImages)}}function J(r,d){if(1&r){const t=e.EpF();e.TgZ(0,"button",33),e.NdJ("click",function(c){e.CHM(t);const a=e.oxw();return a.confirm(c,a.currentItem)}),e._uU(1,"Eliminar"),e.qZA()}}const I=function(r){return{invalid:r}},F=function(r){return{width:r}},B=[{path:"",component:(()=>{class r{constructor(t,i,c,a,l,C,L){this.route=t,this.generalService=i,this.messageService=c,this.promotionsService=a,this.router=l,this.profileProviderService=C,this.confirmationService=L,this.displayModal=!1,this.invalid=new f,this.currentItem=new v,this.currentImages=[],this.images=[],this.config={aspectRatio:1,dragMode:"none",autoCropArea:100},this.deleteImages=[],this.promotionId=this.route.snapshot.paramMap.get("id")}ngOnInit(){this.getCompanies(),this.getPromotion()}getPromotion(){this.promotionId&&this.promotionsService.getById(this.promotionId).subscribe(t=>{this.currentItem=t.data,this.currentItem?this.replaceCurrentImagesByUrls():this.router.navigate(["/admin/promotions"])},t=>{this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})})}getCompanies(){this.profileProviderService.getAllCompanies().subscribe(t=>{this.profileProviders=t.data},t=>{this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})})}onUpload(t,i){t.currentFiles.map(c=>{const a=new FileReader;a.readAsDataURL(c),a.onload=()=>{this.currentFile=c,this.openModalCrroper(a.result),this.fileUpload=i}})}moveCropper(){this.dataImage=this.angularCropper.cropper.crop().getCroppedCanvas({width:400,height:400}).toDataURL()}openModalCrroper(t){this.imageUrl=t,this.dataImage=t,this.displayModal=!0}cropper(){this.currentImages=[...this.currentImages,{file:this.currentFile,blob:this.dataImage,url:null}],this.displayModal=!1,this.fileUpload.clear()}uploadImages(){this.generalService.isLoad(!0),this.generalService.uploadImageMultipleByBlob(this.currentImages,"promotions/").subscribe(t=>{this.generalService.isLoad(!1),"number"==typeof t?this.uploadPercent=t:(this.currentItem.images=[...this.currentItem.images,t],this.add())})}presave(){var t;this.validate()||((null===(t=this.deleteImages)||void 0===t?void 0:t.length)>0?this.generalService.deleteImages(this.deleteImages.map(i=>i.url)).then(()=>{this.uploadImages()}).catch(i=>{this.messageService.add({severity:"error",summary:"Error",detail:"Error al eliminar la imagenes"})}):this.uploadImages())}resetForm(){this.currentItem=new v,this.currentImages=[]}add(){this.currentItem._id||delete this.currentItem._id,this.promotionsService.save(this.currentItem).subscribe(t=>{this.messageService.add({severity:"success",summary:"Mensaje",detail:t.message}),this.replaceCurrentImagesByUrls(),this.promotionId||this.resetForm(),this.displayModal=!1,this.getPromotion()},t=>{this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})})}replaceCurrentImagesByUrls(){this.currentImages=[...this.currentItem.images.map(t=>({file:null,blob:null,url:t}))]}removeImage(t){t.url?(this.deleteImages.push(t),this.currentItem.images=this.currentItem.images.filter(i=>i!==t.url),this.replaceCurrentImagesByUrls()):this.currentImages=this.currentImages.filter(i=>i!==t)}validate(){this.invalid=new f;let t=!1;return this.currentItem.name||(t=!0,this.invalid.name=!0),this.currentItem.profileProviderId||(t=!0,this.invalid.profileProviderId=!0),this.currentItem.description||(t=!0,this.invalid.description=!0),(!this.currentImages||0===this.currentImages.length)&&(t=!0,this.invalid.images=!0),t&&this.messageService.add({severity:"error",summary:"Error",detail:"Revise los campos"}),t}resetUploadButton(){this.fileUpload.clear()}getBlobOrImage(t){return t.blob||t.url}confirm(t,i){this.confirmationService.confirm({target:t.target,message:"\xbfSeg\xfaro que desea eliminar?",icon:"pi pi-exclamation-triangle",acceptLabel:"S\xed",rejectLabel:"No",accept:()=>{this.delete(i)}})}preDelete(t){var i;(null===(i=t.images)||void 0===i?void 0:i.length)>0?this.generalService.deleteImages(t.images).then(()=>{this.currentImages=[],this.delete(t)}).catch(c=>{this.messageService.add({severity:"error",summary:"Error",detail:"Error al eliminar la imagen"}),this.delete(t)}):this.delete(t)}delete(t){this.promotionsService.delete(t._id).subscribe(i=>{this.generalService.c("Delete",i),this.messageService.add({severity:"success",summary:"Mensaje",detail:i.message}),this.router.navigate(["admin/promotions"])},i=>{this.messageService.add({severity:"error",summary:"Error",detail:i.error.message})})}back(){this.router.navigate(["/admin/promotions"])}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(g.gz),e.Y36(u.m),e.Y36(_.ez),e.Y36(n.q),e.Y36(g.F0),e.Y36(s.n),e.Y36(_.YP))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-add-edit"]],viewQuery:function(t,i){if(1&t&&e.Gf(Z,5),2&t){let c;e.iGM(c=e.CRH())&&(i.angularCropper=c.first)}},decls:32,vars:44,consts:[[1,"p-5","col-12","col-md-6"],[1,"btn2",3,"click"],[1,"text-color1","mt-5"],["type","text","placeholder","Nombre",1,"mt-5",3,"ngClass","ngModel","keyup","ngModelChange"],["placeholder","Descripci\xf3n",1,"mt-2",3,"ngClass","ngModel","keyup","ngModelChange"],[1,"mt-1",3,"ngClass","ngModel","change","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","number","placeholder","S/ Precio (opcional)",1,"mt-2",3,"ngModel","ngModelChange"],[1,"mt-5",3,"ngClass"],["styleClass","col-12 btn2","mode","basic","accept","image/*","uploadLabel","Subir","cancelLabel","Cancelar","invalidFileSizeMessageDetail","El tama\xf1o m\xe1ximo es {0}.",3,"fileLimit","maxFileSize","chooseLabel","multiple","files","auto","onSelect"],["fileUpload",""],[1,"loading"],["class","row m-0 justify-content-center align-items-center mt-2",4,"ngIf"],[1,"row","justify-content-center","mt-4"],[1,"btn1","mr-2",3,"click"],["class","btn3 bg-color6",3,"click",4,"ngIf"],["header","",3,"visible","modal","styleClass","baseZIndex","autoZIndex","draggable","resizable","visibleChange","onHide"],[1,"d-flex","justify-content-center"],[1,"container-cropper","p-3"],[3,"cropperOptions","imageUrl","cropmove"],["angularCropper",""],[1,"p-3"],[1,"image","image2",3,"ngStyle"],[1,"col-12","d-flex","justify-content-center","pb-5"],[1,"btn1",3,"click"],[3,"autoZIndex","baseZIndex"],[3,"value"],[1,"row","m-0","justify-content-center","align-items-center","mt-2"],["class","bg-color6 image image-miniature",3,"ngStyle",4,"ngFor","ngForOf"],[1,"bg-color6","image","image-miniature",3,"ngStyle"],[1,"delete",3,"click"],[1,"pi","pi-trash","text-white","f-20"],[1,"btn3","bg-color6",3,"click"]],template:function(t,i){if(1&t){const c=e.EpF();e.TgZ(0,"div",0)(1,"button",1),e.NdJ("click",function(){return i.back()}),e._uU(2,"Atr\xe1s"),e.qZA(),e.TgZ(3,"h4",2),e._uU(4),e.qZA(),e.TgZ(5,"input",3),e.NdJ("keyup",function(){return i.invalid.name=!1})("ngModelChange",function(l){return i.currentItem.name=l}),e.qZA(),e.TgZ(6,"textarea",4),e.NdJ("keyup",function(){return i.invalid.description=!1})("ngModelChange",function(l){return i.currentItem.description=l}),e.qZA(),e.TgZ(7,"select",5),e.NdJ("change",function(){return i.invalid.profileProviderId=!1})("ngModelChange",function(l){return i.currentItem.profileProviderId=l}),e.TgZ(8,"option",6),e._uU(9,"Seleccionar negocio"),e.qZA(),e.YNc(10,P,2,2,"option",7),e.qZA(),e.TgZ(11,"input",8),e.NdJ("ngModelChange",function(l){return i.currentItem.price=l}),e.qZA(),e.TgZ(12,"div",9)(13,"p-fileUpload",10,11),e.NdJ("onSelect",function(l){e.CHM(c);const C=e.MAs(14);return i.onUpload(l,C),i.invalid.images=!1}),e.qZA(),e._UZ(15,"div",12),e.qZA(),e.YNc(16,U,2,1,"div",13),e.TgZ(17,"div",14)(18,"button",15),e.NdJ("click",function(){return i.presave()}),e._uU(19,"Guardar"),e.qZA(),e.YNc(20,J,2,0,"button",16),e.qZA()(),e.TgZ(21,"p-dialog",17),e.NdJ("visibleChange",function(l){return i.displayModal=l})("onHide",function(){return i.resetUploadButton()}),e.TgZ(22,"div",18)(23,"div",19)(24,"angular-cropper",20,21),e.NdJ("cropmove",function(){return i.moveCropper()}),e.qZA()(),e.TgZ(26,"div",22),e._UZ(27,"div",23),e.qZA()(),e.TgZ(28,"div",24)(29,"button",25),e.NdJ("click",function(){return i.cropper()}),e._uU(30,"Subir"),e.qZA()()(),e._UZ(31,"p-confirmPopup",26)}2&t&&(e.xp6(4),e.hij("",i.promotionId?"Editar":"Agregar"," promoci\xf3n"),e.xp6(1),e.Q6J("ngClass",e.VKq(32,I,i.invalid.name))("ngModel",i.currentItem.name),e.xp6(1),e.Q6J("ngClass",e.VKq(34,I,i.invalid.description))("ngModel",i.currentItem.description),e.xp6(1),e.Q6J("ngClass",e.VKq(36,I,i.invalid.profileProviderId))("ngModel",i.currentItem.profileProviderId),e.xp6(3),e.Q6J("ngForOf",i.profileProviders),e.xp6(1),e.Q6J("ngModel",i.currentItem.price),e.xp6(1),e.Q6J("ngClass",e.VKq(38,I,i.invalid.images)),e.xp6(1),e.Q6J("fileLimit",1)("maxFileSize",2048e3)("chooseLabel","Subir imagen")("multiple",!1)("files",i.images)("auto",!1),e.xp6(2),e.Akn(e.VKq(40,F,i.uploadPercent+"%")),e.xp6(1),e.Q6J("ngIf",(null==i.currentImages?null:i.currentImages.length)>0),e.xp6(4),e.Q6J("ngIf",i.currentItem._id),e.xp6(1),e.Q6J("visible",i.displayModal)("modal",!0)("styleClass","modalLogin")("baseZIndex",1e4)("autoZIndex",!0)("draggable",!1)("resizable",!1),e.xp6(3),e.Q6J("cropperOptions",i.config)("imageUrl",i.imageUrl),e.xp6(3),e.Q6J("ngStyle",e.VKq(42,M,"url("+i.dataImage+")")),e.xp6(4),e.Q6J("autoZIndex",!1)("baseZIndex",1000001))},directives:[m.Fj,p.mk,m.JJ,m.On,m.EJ,m.YN,m.Kr,p.sg,m.wV,y.p,p.O5,p.PC,A.V,E.V2,b.P],styles:[".container-cropper[_ngcontent-%COMP%]{max-width:300px}.image2[_ngcontent-%COMP%]{min-width:300px;min-height:300px}.image-miniature[_ngcontent-%COMP%]{min-height:100px;min-width:100px}"]}),r})()}];let x=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[g.Bz.forChild(B)],g.Bz]}),r})();var O=o(3728);let $=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[p.ez,x,A.S,y.O,O.QG,E.dD,m.u5,b.n]]}),r})()},1724:(S,h,o)=>{o.d(h,{n:()=>e});var p=o(5e3),g=o(5830),v=o(1864),f=o(2542);let e=(()=>{class u{constructor(n,s,m){this.api=n,this.general=s,this.authService=m,this.model="profile-provider"}save(n){return this.api.api({service:n._id?`update-${this.model}/${n._id}`:`save-${this.model}`,type:n._id?"patch":"post",data:n})}search(n){return this.api.api({service:`search-${this.model}`,type:"post",data:n})}get(){const n={service:`get-${this.model}-by-user-id/${this.authService.getUserID()}`,type:"get",data:null};return this.api.api(n)}getById(n){return this.api.api({service:`get-${this.model}-by-id/${n}`,type:"get",data:null})}getAllById(n){return this.api.api({service:`get-all-${this.model}-by-id/${n}`,type:"get",data:null})}getByUserId(n){return this.api.api({service:`get-${this.model}-by-user-id/${n}`,type:"get",data:null})}getAllCompanies(){return this.api.api({service:`get-${this.model}`,type:"get",data:null})}delete(n){return this.api.api({service:`delete-${this.model}/${n}`,type:"delete",data:null})}getUrlByProfileProviderId(n){return this.api.api({service:`get-url-by-profile-provider-id/${n}`,type:"get",data:null})}getByArray(n){return this.api.api({service:`get-${this.model}-by-array`,type:"post",data:{profileProviders:n}})}getUrlByUrl(n){return this.api.api({service:`get-url-by-url/${n}`,type:"get",data:null})}}return u.\u0275fac=function(n){return new(n||u)(p.LFG(g.s),p.LFG(v.m),p.LFG(f.e))},u.\u0275prov=p.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()}}]);