"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[867],{867:(X,v,o)=>{o.r(v),o.d(v,{OfferModule:()=>G});var d=o(9808),I=o(9812),c=o(655),b=o(8745);class f{constructor(){this.name="",this.profileProviderId="",this.description="",this.images=[],this.price=null,this.isActive=!1,this.promotionalPrice=null}}class C{constructor(){this.name=!1,this.images=!1,this.price=!1,this.description=!1}}var e=o(5e3),Z=o(9062),T=o(1864),g=o(9783),P=o(1724),S=o(9493),J=o(756),x=o(4281),_=o(5315),y=o(930),u=o(4182),A=o(2251),M=o(7307);function E(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"app-product-list",25),e.NdJ("productsEvent",function(n){return e.CHM(t),e.oxw().offerListEvent(n)}),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("items",t.items)}}const N=function(i){return{"background-image":i}};function U(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"div",28)(1,"div",29),e.NdJ("click",function(){const s=e.CHM(t).$implicit;return e.oxw(2).removeImage(s)}),e._UZ(2,"i",30),e.qZA()()}if(2&i){const t=a.$implicit,r=e.oxw(2);e.Q6J("ngStyle",e.VKq(1,N,"url("+r.getBlobOrImage(t)+")"))}}function F(i,a){if(1&i&&(e.TgZ(0,"div",26),e.YNc(1,U,3,3,"div",27),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.currentImages)}}function Q(i,a){if(1&i){const t=e.EpF();e.TgZ(0,"button",31),e.NdJ("click",function(n){e.CHM(t);const s=e.oxw();return s.confirm(n,s.currentItem)}),e._uU(1,"Eliminar"),e.qZA()}}const p=function(i){return{invalid:i}},j=function(i){return{width:i}},k=[{path:"",component:(()=>{class i{constructor(t,r,n,s,m){this.offerService=t,this.general=r,this.confirmationService=n,this.messageService=s,this.profileProviderService=m,this.subs=new b.Y,this.displayModal=!1,this.displayModalCropper=!1,this.currentItem=new f,this.invalid=new C,this.config={aspectRatio:1,dragMode:"crop",autoCropArea:100},this.images=[],this.deleteImages=[]}ngOnInit(){this.get()}get(){this.profileProviderService.get().subscribe(t=>{var r;this.profileProvider=t.data,this.getProducts(),0===(null===(r=t.data)||void 0===r?void 0:r.length)&&this.messageService.add({severity:"success",summary:"Mensaje",detail:"No hay ofertas disponibles"})},t=>{this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})})}getProducts(){this.offerService.getByProfileProviderId(this.profileProvider._id).subscribe(t=>{var r;this.items=t.data,0===(null===(r=t.data)||void 0===r?void 0:r.length)&&this.messageService.add({severity:"success",summary:"Mensaje",detail:"No hay productos disponibles"})},t=>{this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})})}validate(){var t;this.invalid=new C;let r=!1;return this.currentItem.name||(r=!0,this.invalid.name=!0),0===(null===(t=this.currentImages)||void 0===t?void 0:t.length)&&(r=!0,this.invalid.images=!0),r&&this.messageService.add({severity:"error",summary:"Error",detail:"Revise los campos"}),r}reset(){this.currentItem=new f,this.currentImages=[],this.uploadPercent=0}addEdit(t=null){this.currentImages=[],t?(this.currentItem=t,t.images&&t.images.map(r=>{this.currentImages=[...this.currentImages,{file:null,blob:null,url:r}]})):this.reset(),this.displayModal=!0}confirm(t,r){this.confirmationService.confirm({target:t.target,message:"\xbfSeg\xfaro que desea eliminar?",icon:"pi pi-exclamation-triangle",acceptLabel:"S\xed",rejectLabel:"No",accept:()=>{this.preDelete(r)},reject:()=>{}})}add(){this.subs.add(this.profileProviderService.get().subscribe(t=>{this.profileProvider=t.data,this.currentItem.profileProviderId=this.profileProvider._id,this.subs.add(this.offerService.save(this.currentItem).subscribe(r=>{var n;this.messageService.add({severity:"success",summary:"Mensaje",detail:r.message}),(null===(n=this.currentItem)||void 0===n?void 0:n._id)||this.reset(),this.get(),this.displayModal=!1},r=>{this.messageService.add({severity:"error",summary:"Error",detail:r.error.message})}))},t=>{this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})}))}delete(t){this.currentImages=[],this.subs.add(this.offerService.delete(t._id).subscribe(r=>{this.messageService.add({severity:"success",summary:"Mensaje",detail:r.message}),this.currentItem=new f,this.get()},r=>{this.messageService.add({severity:"error",summary:"Error",detail:r.error.message})}))}preDelete(t){return(0,c.mG)(this,void 0,void 0,function*(){t.images?(yield this.general.deleteImages(t.images),this.delete(t)):this.delete(t)})}removeImage(t){t.url&&(this.deleteImages=[...this.deleteImages,t],this.currentItem.images=[...this.currentItem.images.filter(r=>r!==t.url)]),this.currentImages=[...this.currentImages.filter(r=>r.url!==t.url)]}onUpload(t,r){t.currentFiles.map(n=>{const s=new FileReader;s.readAsDataURL(n),s.onload=()=>{this.currentFile=n,this.openModalCrroper(s.result),this.fileUpload=r}})}resetUploadButton(){this.fileUpload.clear()}openModalCrroper(t){this.imageUrl=t,this.dataImage=t,this.displayModalCropper=!0}presave(){var t;return(0,c.mG)(this,void 0,void 0,function*(){if(this.currentItem.profileProviderId&&this.add(),!this.validate())if(this.general.isLoad(!0),(null===(t=this.deleteImages)||void 0===t?void 0:t.length)>0){const r=[];this.deleteImages.map(n=>{n.url&&r.push(n.url)}),yield this.general.deleteImages(r),this.uploadImages()}else this.uploadImages()})}eventCrop(t){const r=new File([t.file],t.name,{type:"image/*"});this.currentImages=[...this.currentImages,{file:r,blob:t.event,url:null}]}uploadImages(){var t;if((null===(t=this.currentImages)||void 0===t?void 0:t.length)>0){let r=1;this.currentImages.map(n=>(0,c.mG)(this,void 0,void 0,function*(){var s;let m;if(n.blob)fetch(n.blob).then(l=>l.blob()).then(l=>(0,c.mG)(this,void 0,void 0,function*(){var h;const H=new File([l],n.file.name,{type:n.file.type}),O=yield null===(h=this.general.uploadImage(H,"products/"))||void 0===h?void 0:h.toPromise();O&&(this.currentItem.images=[...this.currentItem.images,O]),this.uploadPercent=100*r/this.currentImages.length,r++,r===this.currentImages.length+1&&this.add()}));else if(n.file){m=n.file;const l=yield null===(s=this.general.uploadImage(m,"products/"))||void 0===s?void 0:s.toPromise();l&&(this.currentItem.images=[...this.currentItem.images,l]),this.uploadPercent=100*r/this.currentImages.length,r++,r===this.currentImages.length+1&&this.add()}}))}else this.add()}getBlobOrImage(t){return t.blob||t.url}offerListEvent(t){"edit"===t.function&&this.addEdit(t.data)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Z.K),e.Y36(T.m),e.Y36(g.YP),e.Y36(g.ez),e.Y36(P.n))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-offer"]],decls:33,vars:38,consts:[[1,"d-flex","m-0"],[1,"d-none","d-md-flex"],[1,"flex-1"],[1,"p-4","p-md-5"],[1,"row","m-0","justify-content-between","align-items-center"],[1,"btn2",3,"click"],[1,"pi","pi-plus","mr-2"],[1,"section-offers","col-4","p-0"],[3,"items","productsEvent",4,"ngIf"],["header","",3,"visible","modal","styleClass","baseZIndex","autoZIndex","draggable","resizable","visibleChange"],[1,"col-12","row","m-0","justify-content-center"],[1,"row","m-0","p-0","flex-column","col-12","col-md-6"],[1,"row","align-items-center","m-0"],[3,"disabled","ngModel","ngModelChange"],[1,"ml-4"],["type","text",1,"mt-3",3,"ngModel","ngClass","placeholder","keyup.enter","ngModelChange","keyup"],[1,"mt-3",3,"ngClass"],[3,"events"],[1,"loading"],["class","row m-0 justify-content-center align-items-center mt-2",4,"ngIf"],["cols","30","rows","5",3,"ngModel","ngClass","placeholder","keyup.enter","ngModelChange"],["type","text",1,"mt-3",3,"ngModel","placeholder","keyup.enter","ngModelChange"],[1,"btn1","mt-4","mb-4",3,"click"],["class","btn3 bg-color6 pt-2 pb-2 mt-2 mb-4",3,"click",4,"ngIf"],[3,"autoZIndex","baseZIndex"],[3,"items","productsEvent"],[1,"row","m-0","justify-content-center","align-items-center","mt-2"],["class","image-miniature m-2",3,"ngStyle",4,"ngFor","ngForOf"],[1,"image-miniature","m-2",3,"ngStyle"],[1,"delete",3,"click"],[1,"pi","pi-trash","text-white","f-20"],[1,"btn3","bg-color6","pt-2","pb-2","mt-2","mb-4",3,"click"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"app-menu-provider",1),e.TgZ(2,"div",2),e._UZ(3,"app-header-provider"),e.TgZ(4,"div",3)(5,"div",4)(6,"h4"),e._uU(7,"Ofertas"),e.qZA(),e.TgZ(8,"button",5),e.NdJ("click",function(){return r.addEdit()}),e._UZ(9,"i",6),e._uU(10," Agregar "),e.qZA()(),e.TgZ(11,"div",7),e.YNc(12,E,1,1,"app-product-list",8),e.qZA()()()(),e.TgZ(13,"p-dialog",9),e.NdJ("visibleChange",function(s){return r.displayModal=s}),e.TgZ(14,"div",10)(15,"div",11)(16,"div",12)(17,"p-inputSwitch",13),e.NdJ("ngModelChange",function(s){return r.currentItem.isActive=s}),e.qZA(),e.TgZ(18,"label",14),e._uU(19,"Activa"),e.qZA()(),e.TgZ(20,"input",15),e.NdJ("keyup.enter",function(){return r.add()})("ngModelChange",function(s){return r.currentItem.name=s})("keyup",function(){return r.invalid.name=!1}),e.qZA(),e.TgZ(21,"div",16)(22,"app-crop-image",17),e.NdJ("events",function(s){return r.eventCrop(s)}),e.qZA(),e._UZ(23,"div",18),e.qZA(),e.YNc(24,F,2,1,"div",19),e.TgZ(25,"textarea",20),e.NdJ("keyup.enter",function(){return r.add()})("ngModelChange",function(s){return r.currentItem.description=s}),e.qZA(),e.TgZ(26,"input",15),e.NdJ("keyup.enter",function(){return r.add()})("ngModelChange",function(s){return r.currentItem.price=s})("keyup",function(){return r.invalid.price=!1}),e.qZA(),e.TgZ(27,"input",21),e.NdJ("keyup.enter",function(){return r.add()})("ngModelChange",function(s){return r.currentItem.promotionalPrice=s}),e.qZA(),e._UZ(28,"div"),e.TgZ(29,"button",22),e.NdJ("click",function(){return r.presave()}),e._uU(30,"Guardar"),e.qZA(),e.YNc(31,Q,2,0,"button",23),e.qZA()()(),e._UZ(32,"p-confirmPopup",24)),2&t&&(e.xp6(12),e.Q6J("ngIf",(null==r.items?null:r.items.length)>0),e.xp6(1),e.Q6J("visible",r.displayModal)("modal",!0)("styleClass","modalLogin")("baseZIndex",1e4)("autoZIndex",!1)("draggable",!1)("resizable",!1),e.xp6(4),e.Q6J("disabled",!!r.currentItem._id)("ngModel",r.currentItem.isActive),e.xp6(3),e.Q6J("ngModel",r.currentItem.name)("ngClass",e.VKq(28,p,r.invalid.name))("placeholder","Oferta"),e.xp6(1),e.Q6J("ngClass",e.VKq(30,p,r.invalid.images)),e.xp6(2),e.Akn(e.VKq(32,j,r.uploadPercent+"%")),e.xp6(1),e.Q6J("ngIf",r.currentImages),e.xp6(1),e.Q6J("ngModel",r.currentItem.description)("ngClass",e.VKq(34,p,r.invalid.description))("placeholder","Descripci\xf3n"),e.xp6(1),e.Q6J("ngModel",r.currentItem.price)("ngClass",e.VKq(36,p,r.invalid.price))("placeholder","Precio"),e.xp6(1),e.Q6J("ngModel",r.currentItem.promotionalPrice)("placeholder","Precio promocional"),e.xp6(4),e.Q6J("ngIf",r.currentItem._id),e.xp6(1),e.Q6J("autoZIndex",!1)("baseZIndex",1000001))},directives:[S.O,J.x,d.O5,x.X,_.V,y.Ql,u.JJ,u.On,u.Fj,d.mk,A.C,d.sg,d.PC,M.P],styles:[".section-offers[_ngcontent-%COMP%]{max-width:100%!important}.container-cropper[_ngcontent-%COMP%]{max-width:300px}.image2[_ngcontent-%COMP%]{min-width:300px;min-height:300px}.image-miniature[_ngcontent-%COMP%]{min-height:100px;min-width:100px}"]}),i})()}];let w=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[I.Bz.forChild(k)],I.Bz]}),i})();var Y=o(636),B=o(7118),V=o(7840),K=o(7773),L=o(27),R=o(8478),z=o(907),D=o(9474);let G=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[g.YP],imports:[[d.ez,w,Y.p,B.S,V.C,_.S,u.u5,K.EV,M.n,L.O,R.f,y.Iu,z.dD,D.i]]}),i})()}}]);