(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{a5Ms:function(e,t,i){"use strict";i.r(t),i.d(t,"ProductModule",function(){return _});var r=i("ofXK"),s=i("tyNb"),n=i("mrSG"),a=i("FQVY"),c=i("33Jv");class o{constructor(){this.name="",this.profileProviderId="",this.description="",this.images=[],this.price=null,this.isFeatured=!1,this.promotionalPrice=null}}class l{constructor(){this.name=!1,this.images=!1,this.price=!1,this.description=!1}}var d=i("mgFt"),u=i("zhhV"),m=i("fXoL"),p=i("7zfz"),b=i("yGOr"),g=i("vr5I"),h=i("/RsI"),v=i("rLzU"),f=i("3Pt+"),I=i("NCSE"),y=i("RTT/"),P=i("g8TO");function k(e,t){if(1&e){const e=m.Vb();m.Ub(0,"app-product-list",25),m.bc("productsEvent",function(t){return m.Bc(e),m.ec().productListEvent(t)}),m.Tb()}if(2&e){const e=m.ec();m.kc("profileProviderId",e.profileProvider._id)("items",e.items)}}const C=function(e){return{"background-image":e}};function S(e,t){if(1&e){const e=m.Vb();m.Ub(0,"div",28),m.Ub(1,"div",29),m.bc("click",function(){m.Bc(e);const i=t.$implicit;return m.ec(2).removeImage(i)}),m.Pb(2,"i",30),m.Tb(),m.Tb()}if(2&e){const e=t.$implicit,i=m.ec(2);m.kc("ngStyle",m.pc(1,C,"url("+i.getBlobOrImage(e)+")"))}}function M(e,t){if(1&e&&(m.Ub(0,"div",26),m.Hc(1,S,3,3,"div",27),m.Tb()),2&e){const e=m.ec();m.Cb(1),m.kc("ngForOf",e.currentImages)}}function U(e,t){if(1&e){const e=m.Vb();m.Ub(0,"button",31),m.bc("click",function(t){m.Bc(e);const i=m.ec();return i.confirm(t,i.currentItem)}),m.Jc(1,"Eliminar"),m.Tb()}}const w=function(e){return{invalid:e}},T=function(e){return{width:e}},x=[{path:"",component:(()=>{class e{constructor(e,t,i,r,s){this.productService=e,this.general=t,this.confirmationService=i,this.messageService=r,this.profileProviderService=s,this.subs=new c.a,this.displayModal=!1,this.currentItem=new o,this.invalid=new l,this.currentImages=[],this.images=[],this.deleteImages=[]}ngOnInit(){this.getProfileProvider()}getProfileProvider(){this.profileProviderService.get().subscribe(e=>{this.profileProvider=e.data,this.getProducts()},e=>{this.messageService.add({severity:"error",summary:"Error",detail:e.error.message})})}getProducts(){this.subs.add(this.productService.getByProfileProviderId(this.profileProvider._id).subscribe(e=>{var t;this.items=e.data,0===(null===(t=e.data)||void 0===t?void 0:t.length)&&this.messageService.add({severity:"success",summary:"Mensaje",detail:"No hay productos disponibles"})},e=>{this.messageService.add({severity:"error",summary:"Error",detail:e.error.message})}))}validate(){var e;this.invalid=new l;let t=!1;return this.currentItem.name||(t=!0,this.invalid.name=!0),0===(null===(e=this.currentImages)||void 0===e?void 0:e.length)&&(t=!0,this.invalid.images=!0),t&&this.messageService.add({severity:"error",summary:"Error",detail:"Revise los campos"}),t}reset(){this.currentItem=new o,this.currentImages=[],this.uploadPercent=0}addEdit(e=null){this.currentImages=[],e?(this.currentItem=e,e.images&&e.images.map(e=>{this.currentImages=[...this.currentImages,{file:null,blob:null,url:e}]})):this.reset(),this.displayModal=!0}confirm(e,t){this.confirmationService.confirm({target:e.target,message:"\xbfSeg\xfaro que desea eliminar?",icon:"pi pi-exclamation-triangle",acceptLabel:"S\xed",rejectLabel:"No",accept:()=>{this.preDelete(t)},reject:()=>{}})}add(){this.currentItem.profileProviderId=this.profileProvider._id,this.productService.save(this.currentItem).subscribe(e=>{var t;this.messageService.add({severity:"success",summary:"Mensaje",detail:e.message}),(null===(t=this.currentItem)||void 0===t?void 0:t._id)||this.reset(),this.getProducts()},e=>{this.messageService.add({severity:"error",summary:"Error",detail:e.error.message})})}delete(e){this.currentImages=[],this.subs.add(this.productService.delete(e._id).subscribe(e=>{this.messageService.add({severity:"success",summary:"Mensaje",detail:e.message}),this.currentItem=new o,this.getProducts()},e=>{this.messageService.add({severity:"error",summary:"Error",detail:e.error.message})}))}preDelete(e){return Object(n.b)(this,void 0,void 0,function*(){e.images?(yield this.general.deleteImages(e.images),this.delete(e)):this.delete(e)})}removeImage(e){e.url&&(this.deleteImages=[...this.deleteImages,e],this.currentItem.images=[...this.currentItem.images.filter(t=>t!==e.url)]),this.currentImages=[...this.currentImages.filter(t=>t.url!==e.url)]}onUpload(e){e.currentFiles.map(e=>{const t=new FileReader;t.readAsDataURL(e),t.onload=()=>{this.currentImages=[...this.currentImages,{file:e,blob:t.result,url:null}]}}),this.images=[]}presave(){var e;return Object(n.b)(this,void 0,void 0,function*(){if(!this.validate())if(this.general.isLoad(!0),(null===(e=this.deleteImages)||void 0===e?void 0:e.length)>0){const e=[];this.deleteImages.map(t=>{t.url&&e.push(t.url)}),yield this.general.deleteImages(e),this.uploadImages()}else this.uploadImages()})}uploadImages(){var e;if((null===(e=this.currentImages)||void 0===e?void 0:e.length)>0){let e=1;this.currentImages.map(t=>Object(n.b)(this,void 0,void 0,function*(){var i;if(t.file){const e=yield null===(i=this.general.uploadImage(t.file,"products/"))||void 0===i?void 0:i.toPromise();e&&(this.currentItem.images=[...this.currentItem.images,e])}this.uploadPercent=100*e/this.currentImages.length,e++,e===this.currentImages.length+1&&this.add()}))}else this.add()}getBlobOrImage(e){return e.blob||e.url}productListEvent(e){switch(e.function){case"edit":this.addEdit(e.data)}}}return e.\u0275fac=function(t){return new(t||e)(m.Ob(d.a),m.Ob(a.a),m.Ob(p.b),m.Ob(p.h),m.Ob(u.a))},e.\u0275cmp=m.Ib({type:e,selectors:[["app-product"]],decls:32,vars:44,consts:[[1,"d-flex","m-0"],[1,"d-none","d-md-flex"],[1,"flex-1"],[1,"p-4","p-md-5"],[1,"row","m-0","justify-content-between","align-items-center"],[1,"btn2",3,"click"],[1,"pi","pi-plus","mr-2"],[1,"section-products","col-4","p-0"],[3,"profileProviderId","items","productsEvent",4,"ngIf"],["header","",3,"visible","modal","styleClass","baseZIndex","autoZIndex","draggable","resizable","visibleChange"],[1,"col-12","row","m-0","justify-content-center"],[1,"row","m-0","p-0","flex-column","col-12","col-md-10"],[1,"row","align-items-center","m-0"],[3,"disabled","ngModel","ngModelChange"],[1,"ml-4"],["type","text",1,"mt-3",3,"ngModel","ngClass","placeholder","keyup.enter","ngModelChange","keyup"],[1,"mt-3",3,"ngClass"],["styleClass","col-12 btn2","mode","basic","accept","image/*","uploadLabel","Subir","cancelLabel","Cancelar","invalidFileSizeMessageDetail","El tama\xf1o m\xe1ximo es {0}.",3,"fileLimit","multiple","maxFileSize","chooseLabel","files","auto","onSelect"],[1,"loading"],["class","row m-0 justify-content-center align-items-center mt-2",4,"ngIf"],["cols","30","rows","5",3,"ngModel","ngClass","placeholder","keyup.enter","ngModelChange"],["type","text",1,"mt-3",3,"ngModel","placeholder","keyup.enter","ngModelChange"],[1,"btn1","mt-4",3,"click"],["class","btn3 bg-color6 pt-2 pb-2 mt-2",3,"click",4,"ngIf"],[3,"autoZIndex","baseZIndex"],[3,"profileProviderId","items","productsEvent"],[1,"row","m-0","justify-content-center","align-items-center","mt-2"],["class","image-miniature m-2",3,"ngStyle",4,"ngFor","ngForOf"],[1,"image-miniature","m-2",3,"ngStyle"],[1,"delete",3,"click"],[1,"pi","pi-trash","text-white","f-20"],[1,"btn3","bg-color6","pt-2","pb-2","mt-2",3,"click"]],template:function(e,t){1&e&&(m.Ub(0,"div",0),m.Pb(1,"app-menu-provider",1),m.Ub(2,"div",2),m.Pb(3,"app-header-provider"),m.Ub(4,"div",3),m.Ub(5,"div",4),m.Ub(6,"h4"),m.Jc(7,"Productos"),m.Tb(),m.Ub(8,"button",5),m.bc("click",function(){return t.addEdit()}),m.Pb(9,"i",6),m.Jc(10," Agregar "),m.Tb(),m.Tb(),m.Ub(11,"div",7),m.Hc(12,k,1,2,"app-product-list",8),m.Tb(),m.Tb(),m.Tb(),m.Tb(),m.Ub(13,"p-dialog",9),m.bc("visibleChange",function(e){return t.displayModal=e}),m.Ub(14,"div",10),m.Ub(15,"div",11),m.Ub(16,"div",12),m.Ub(17,"p-inputSwitch",13),m.bc("ngModelChange",function(e){return t.currentItem.profileProviderId=e}),m.Tb(),m.Ub(18,"label",14),m.Jc(19,"Destacado"),m.Tb(),m.Tb(),m.Ub(20,"input",15),m.bc("keyup.enter",function(){return t.add()})("ngModelChange",function(e){return t.currentItem.name=e})("keyup",function(){return t.invalid.name=!1}),m.Tb(),m.Ub(21,"div",16),m.Ub(22,"p-fileUpload",17),m.bc("onSelect",function(e){return t.onUpload(e),t.invalid.images=!1}),m.Tb(),m.Pb(23,"div",18),m.Tb(),m.Hc(24,M,2,1,"div",19),m.Ub(25,"textarea",20),m.bc("keyup.enter",function(){return t.add()})("ngModelChange",function(e){return t.currentItem.description=e}),m.Tb(),m.Ub(26,"input",15),m.bc("keyup.enter",function(){return t.add()})("ngModelChange",function(e){return t.currentItem.price=e})("keyup",function(){return t.invalid.price=!1}),m.Tb(),m.Ub(27,"input",21),m.bc("keyup.enter",function(){return t.add()})("ngModelChange",function(e){return t.currentItem.promotionalPrice=e}),m.Tb(),m.Ub(28,"button",22),m.bc("click",function(){return t.presave()}),m.Jc(29,"Guardar"),m.Tb(),m.Hc(30,U,2,0,"button",23),m.Tb(),m.Tb(),m.Tb(),m.Pb(31,"p-confirmPopup",24)),2&e&&(m.Cb(12),m.kc("ngIf",(null==t.items?null:t.items.length)>0),m.Cb(1),m.kc("visible",t.displayModal)("modal",!0)("styleClass","modalLogin")("baseZIndex",1e4)("autoZIndex",!1)("draggable",!1)("resizable",!1),m.Cb(4),m.kc("disabled",!!t.currentItem._id)("ngModel",t.currentItem.profileProviderId),m.Cb(3),m.kc("ngModel",t.currentItem.name)("ngClass",m.pc(34,w,t.invalid.name))("placeholder","Producto"),m.Cb(1),m.kc("ngClass",m.pc(36,w,t.invalid.images)),m.Cb(1),m.kc("fileLimit",5)("multiple",!0)("maxFileSize",1e7)("chooseLabel","Subir Im\xe1genes")("files",t.images)("auto",!1),m.Cb(1),m.Fc(m.pc(38,T,t.uploadPercent+"%")),m.Cb(1),m.kc("ngIf",t.currentImages),m.Cb(1),m.kc("ngModel",t.currentItem.description)("ngClass",m.pc(40,w,t.invalid.description))("placeholder","Descripci\xf3n"),m.Cb(1),m.kc("ngModel",t.currentItem.price)("ngClass",m.pc(42,w,t.invalid.price))("placeholder","Precio"),m.Cb(1),m.kc("ngModel",t.currentItem.promotionalPrice)("placeholder","Precio promocional"),m.Cb(3),m.kc("ngIf",t.currentItem._id),m.Cb(1),m.kc("autoZIndex",!1)("baseZIndex",1000001))},directives:[b.a,g.a,r.k,h.a,v.a,f.d,f.e,f.a,r.i,I.a,y.a,P.a,r.j,r.l],styles:[".section-products[_ngcontent-%COMP%]{max-width:100%!important}"]}),e})()}];let L=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=m.Mb({type:e}),e.\u0275inj=m.Lb({imports:[[s.f.forChild(x)],s.f]}),e})();var O=i("6Gmc"),E=i("OteU"),j=i("cQJI"),F=i("Gxio"),$=i("s8BD");let _=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=m.Mb({type:e}),e.\u0275inj=m.Lb({providers:[p.b],imports:[[r.c,L,O.a,E.a,j.b,h.b,f.b,F.b,y.b,I.b,$.a,v.b]]}),e})()},mgFt:function(e,t,i){"use strict";i.d(t,"a",function(){return n});var r=i("H+bZ"),s=i("fXoL");let n=(()=>{class e{constructor(e){this.api=e,this.model="product"}save(e){return this.api.api({service:e._id?`update-${this.model}/${e._id}`:`save-${this.model}`,type:e._id?"patch":"post",data:e})}get(){return this.api.api({service:`get-${this.model}`,type:"get",data:null})}getByIds(e){return this.api.api({service:`get-${this.model}-by-ids`,type:"post",data:{ids:e}})}getByProfileProviderId(e){return this.api.api({service:`get-${this.model}-by-profile-provider-id/${e}`,type:"get",data:null})}delete(e){return this.api.api({service:`delete-${this.model}/${e}`,type:"delete",data:null})}}return e.\u0275fac=function(t){return new(t||e)(s.Yb(r.a))},e.\u0275prov=s.Kb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);