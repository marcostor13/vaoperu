"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[867],{867:(H,g,o)=>{o.r(g),o.d(g,{OfferModule:()=>R});var d=o(9808),h=o(9812),u=o(655),O=o(8745);class c{constructor(){this.name="",this.profileProviderId="",this.description="",this.images=[],this.price=null,this.isActive=!1,this.promotionalPrice=null}}class v{constructor(){this.name=!1,this.images=!1,this.price=!1,this.description=!1}}var e=o(5e3),M=o(9062),T=o(1864),f=o(9783),S=o(1724),J=o(9493),x=o(756),A=o(3957),_=o(5315),C=o(930),p=o(4182),I=o(986),y=o(907),b=o(7307);const U=["angularCropper"];function P(i,l){if(1&i){const r=e.EpF();e.TgZ(0,"app-product-list",35),e.NdJ("offersEvent",function(s){return e.CHM(r),e.oxw().offerListEvent(s)}),e.qZA()}if(2&i){const r=e.oxw();e.Q6J("items",r.items)}}const Z=function(i){return{"background-image":i}};function E(i,l){if(1&i){const r=e.EpF();e.TgZ(0,"div",38)(1,"div",39),e.NdJ("click",function(){const n=e.CHM(r).$implicit;return e.oxw(2).removeImage(n)}),e._UZ(2,"i",40),e.qZA()()}if(2&i){const r=l.$implicit,t=e.oxw(2);e.Q6J("ngStyle",e.VKq(1,Z,"url("+t.getBlobOrImage(r)+")"))}}function N(i,l){if(1&i&&(e.TgZ(0,"div",36),e.YNc(1,E,3,3,"div",37),e.qZA()),2&i){const r=e.oxw();e.xp6(1),e.Q6J("ngForOf",r.currentImages)}}function Q(i,l){if(1&i){const r=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(s){e.CHM(r);const n=e.oxw();return n.confirm(s,n.currentItem)}),e._uU(1,"Eliminar"),e.qZA()}}const m=function(i){return{invalid:i}},F=function(i){return{width:i}},k=[{path:"",component:(()=>{class i{constructor(r,t,s,n,a){this.offerService=r,this.general=t,this.confirmationService=s,this.messageService=n,this.profileProviderService=a,this.subs=new O.Y,this.displayModal=!1,this.displayModalCropper=!1,this.currentItem=new c,this.invalid=new v,this.config={aspectRatio:1,dragMode:"none",autoCropArea:100},this.images=[]}ngOnInit(){this.get()}get(){this.subs.add(this.offerService.get().subscribe(r=>{var t;this.items=[...r.data],0===(null===(t=r.data)||void 0===t?void 0:t.length)&&this.messageService.add({severity:"success",summary:"Mensaje",detail:"No hay ofertas disponibles"})},r=>{this.messageService.add({severity:"error",summary:"Error",detail:r.error.message})}))}validate(){var r;this.invalid=new v;let t=!1;return this.currentItem.name||(t=!0,this.invalid.name=!0),0===(null===(r=this.currentImages)||void 0===r?void 0:r.length)&&(t=!0,this.invalid.images=!0),t&&this.messageService.add({severity:"error",summary:"Error",detail:"Revise los campos"}),t}reset(){this.currentItem=new c,this.currentImages=[],this.uploadPercent=0}addEdit(r=null){this.currentImages=[],r?(this.currentItem=r,r.images&&r.images.map(t=>{this.currentImages=[...this.currentImages,{file:null,blob:null,url:t}]})):this.reset(),this.displayModal=!0}confirm(r,t){this.confirmationService.confirm({target:r.target,message:"\xbfSeg\xfaro que desea eliminar?",icon:"pi pi-exclamation-triangle",acceptLabel:"S\xed",rejectLabel:"No",accept:()=>{this.preDelete(t)},reject:()=>{}})}add(){this.subs.add(this.profileProviderService.get().subscribe(r=>{this.profileProvider=r.data,this.currentItem.profileProviderId=this.profileProvider._id,this.subs.add(this.offerService.save(this.currentItem).subscribe(t=>{var s;this.messageService.add({severity:"success",summary:"Mensaje",detail:t.message}),(null===(s=this.currentItem)||void 0===s?void 0:s._id)||this.reset(),this.get(),this.displayModal=!1},t=>{this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})}))},r=>{this.messageService.add({severity:"error",summary:"Error",detail:r.error.message})}))}delete(r){this.currentImages=[],this.subs.add(this.offerService.delete(r._id).subscribe(t=>{this.messageService.add({severity:"success",summary:"Mensaje",detail:t.message}),this.currentItem=new c,this.get()},t=>{this.messageService.add({severity:"error",summary:"Error",detail:t.error.message})}))}preDelete(r){return(0,u.mG)(this,void 0,void 0,function*(){r.images?(yield this.general.deleteImages(r.images),this.delete(r)):this.delete(r)})}removeImage(r){r.url&&(this.deleteImages=[...this.deleteImages,r],this.currentItem.images=[...this.currentItem.images.filter(t=>t!==r.url)]),this.currentImages=[...this.currentImages.filter(t=>t.url!==r.url)]}onUpload(r,t){r.currentFiles.map(s=>{const n=new FileReader;n.readAsDataURL(s),n.onload=()=>{this.currentFile=s,this.openModalCrroper(n.result),this.fileUpload=t}})}resetUploadButton(){this.fileUpload.clear()}moveCropper(){this.dataImage=this.angularCropper.cropper.crop().getCroppedCanvas({width:400,height:400}).toDataURL()}openModalCrroper(r){this.imageUrl=r,this.dataImage=r,this.displayModalCropper=!0}cropper(){this.currentImages=[...this.currentImages,{file:this.currentFile,blob:this.dataImage,url:null}],this.displayModalCropper=!1,this.fileUpload.clear()}presave(){var r;return(0,u.mG)(this,void 0,void 0,function*(){if(!this.validate())if(this.general.isLoad(!0),(null===(r=this.deleteImages)||void 0===r?void 0:r.length)>0){const t=[];this.deleteImages.map(n=>{n.url&&t.push(n.url)}),yield this.general.deleteImages(t),this.uploadImages()}else this.uploadImages()})}uploadImages(){var r;if((null===(r=this.currentImages)||void 0===r?void 0:r.length)>0){let t=1;this.currentImages.map(s=>(0,u.mG)(this,void 0,void 0,function*(){var n;if(s.file){const a=yield null===(n=this.general.uploadImage(s.file,"offers/"))||void 0===n?void 0:n.toPromise();a&&(this.currentItem.images=[...this.currentItem.images,a])}this.uploadPercent=100*t/this.currentImages.length,t++,t===this.currentImages.length+1&&this.add()}))}else this.add()}getBlobOrImage(r){return r.blob||r.url}offerListEvent(r){"edit"===r.function&&this.addEdit(r.data)}}return i.\u0275fac=function(r){return new(r||i)(e.Y36(M.K),e.Y36(T.m),e.Y36(f.YP),e.Y36(f.ez),e.Y36(S.n))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-offer"]],viewQuery:function(r,t){if(1&r&&e.Gf(U,5),2&r){let s;e.iGM(s=e.CRH())&&(t.angularCropper=s.first)}},decls:44,vars:56,consts:[[1,"d-flex","m-0"],[1,"d-none","d-md-flex"],[1,"flex-1"],[1,"p-4","p-md-5"],[1,"row","m-0","justify-content-between","align-items-center"],[1,"btn2",3,"click"],[1,"pi","pi-plus","mr-2"],[1,"section-offers","col-4","p-0"],[3,"items","offersEvent",4,"ngIf"],["header","",3,"visible","modal","styleClass","baseZIndex","autoZIndex","draggable","resizable","visibleChange"],[1,"col-12","row","m-0","justify-content-center"],[1,"row","m-0","p-0","flex-column","col-12","col-md-6"],[1,"row","align-items-center","m-0"],[3,"disabled","ngModel","ngModelChange"],[1,"ml-4"],["type","text",1,"mt-3",3,"ngModel","ngClass","placeholder","keyup.enter","ngModelChange","keyup"],[1,"mt-3",3,"ngClass"],["styleClass","col-12 btn2","mode","basic","accept","image/*","uploadLabel","Subir","cancelLabel","Cancelar","invalidFileSizeMessageDetail","El tama\xf1o m\xe1ximo es {0}.",3,"fileLimit","multiple","maxFileSize","chooseLabel","files","auto","onSelect"],["fileUpload",""],[1,"loading"],["class","row m-0 justify-content-center align-items-center mt-2",4,"ngIf"],["cols","30","rows","5",3,"ngModel","ngClass","placeholder","keyup.enter","ngModelChange"],["type","text",1,"mt-3",3,"ngModel","placeholder","keyup.enter","ngModelChange"],[1,"btn1","mt-4","mb-4",3,"click"],["class","btn3 bg-color6 pt-2 pb-2 mt-2 mb-4",3,"click",4,"ngIf"],["header","",3,"visible","modal","styleClass","baseZIndex","autoZIndex","draggable","resizable","visibleChange","onHide"],[1,"d-flex","justify-content-center"],[1,"container-cropper","p-3"],[3,"cropperOptions","imageUrl","cropmove"],["angularCropper",""],[1,"p-3"],[1,"image","image2",3,"ngStyle"],[1,"col-12","d-flex","justify-content-center","pb-5"],[1,"btn1",3,"click"],[3,"autoZIndex","baseZIndex"],[3,"items","offersEvent"],[1,"row","m-0","justify-content-center","align-items-center","mt-2"],["class","image-miniature m-2",3,"ngStyle",4,"ngFor","ngForOf"],[1,"image-miniature","m-2",3,"ngStyle"],[1,"delete",3,"click"],[1,"pi","pi-trash","text-white","f-20"],[1,"btn3","bg-color6","pt-2","pb-2","mt-2","mb-4",3,"click"]],template:function(r,t){if(1&r){const s=e.EpF();e.TgZ(0,"div",0),e._UZ(1,"app-menu-provider",1),e.TgZ(2,"div",2),e._UZ(3,"app-header-provider"),e.TgZ(4,"div",3)(5,"div",4)(6,"h4"),e._uU(7,"Ofertas"),e.qZA(),e.TgZ(8,"button",5),e.NdJ("click",function(){return t.addEdit()}),e._UZ(9,"i",6),e._uU(10," Agregar "),e.qZA()(),e.TgZ(11,"div",7),e.YNc(12,P,1,1,"app-product-list",8),e.qZA()()()(),e.TgZ(13,"p-dialog",9),e.NdJ("visibleChange",function(a){return t.displayModal=a}),e.TgZ(14,"div",10)(15,"div",11)(16,"div",12)(17,"p-inputSwitch",13),e.NdJ("ngModelChange",function(a){return t.currentItem.isActive=a}),e.qZA(),e.TgZ(18,"label",14),e._uU(19,"Activa"),e.qZA()(),e.TgZ(20,"input",15),e.NdJ("keyup.enter",function(){return t.add()})("ngModelChange",function(a){return t.currentItem.name=a})("keyup",function(){return t.invalid.name=!1}),e.qZA(),e.TgZ(21,"div",16)(22,"p-fileUpload",17,18),e.NdJ("onSelect",function(a){e.CHM(s);const B=e.MAs(23);return t.onUpload(a,B),t.invalid.images=!1}),e.qZA(),e._UZ(24,"div",19),e.qZA(),e.YNc(25,N,2,1,"div",20),e.TgZ(26,"textarea",21),e.NdJ("keyup.enter",function(){return t.add()})("ngModelChange",function(a){return t.currentItem.description=a}),e.qZA(),e.TgZ(27,"input",15),e.NdJ("keyup.enter",function(){return t.add()})("ngModelChange",function(a){return t.currentItem.price=a})("keyup",function(){return t.invalid.price=!1}),e.qZA(),e.TgZ(28,"input",22),e.NdJ("keyup.enter",function(){return t.add()})("ngModelChange",function(a){return t.currentItem.promotionalPrice=a}),e.qZA(),e._UZ(29,"div"),e.TgZ(30,"button",23),e.NdJ("click",function(){return t.presave()}),e._uU(31,"Guardar"),e.qZA(),e.YNc(32,Q,2,0,"button",24),e.qZA()()(),e.TgZ(33,"p-dialog",25),e.NdJ("visibleChange",function(a){return t.displayModalCropper=a})("onHide",function(){return t.resetUploadButton()}),e.TgZ(34,"div",26)(35,"div",27)(36,"angular-cropper",28,29),e.NdJ("cropmove",function(){return t.moveCropper()}),e.qZA()(),e.TgZ(38,"div",30),e._UZ(39,"div",31),e.qZA()(),e.TgZ(40,"div",32)(41,"button",33),e.NdJ("click",function(){return t.cropper()}),e._uU(42,"Subir"),e.qZA()()(),e._UZ(43,"p-confirmPopup",34)}2&r&&(e.xp6(12),e.Q6J("ngIf",(null==t.items?null:t.items.length)>0),e.xp6(1),e.Q6J("visible",t.displayModal)("modal",!0)("styleClass","modalLogin")("baseZIndex",1e4)("autoZIndex",!1)("draggable",!1)("resizable",!1),e.xp6(4),e.Q6J("disabled",!!t.currentItem._id)("ngModel",t.currentItem.isActive),e.xp6(3),e.Q6J("ngModel",t.currentItem.name)("ngClass",e.VKq(44,m,t.invalid.name))("placeholder","Oferta"),e.xp6(1),e.Q6J("ngClass",e.VKq(46,m,t.invalid.images)),e.xp6(1),e.Q6J("fileLimit",5)("multiple",!0)("maxFileSize",1e7)("chooseLabel","Subir Im\xe1genes")("files",t.images)("auto",!1),e.xp6(2),e.Akn(e.VKq(48,F,t.uploadPercent+"%")),e.xp6(1),e.Q6J("ngIf",t.currentImages),e.xp6(1),e.Q6J("ngModel",t.currentItem.description)("ngClass",e.VKq(50,m,t.invalid.description))("placeholder","Descripci\xf3n"),e.xp6(1),e.Q6J("ngModel",t.currentItem.price)("ngClass",e.VKq(52,m,t.invalid.price))("placeholder","Precio"),e.xp6(1),e.Q6J("ngModel",t.currentItem.promotionalPrice)("placeholder","Precio promocional"),e.xp6(4),e.Q6J("ngIf",t.currentItem._id),e.xp6(1),e.Q6J("visible",t.displayModalCropper)("modal",!0)("styleClass","modalLogin")("baseZIndex",1e4)("autoZIndex",!0)("draggable",!1)("resizable",!1),e.xp6(3),e.Q6J("cropperOptions",t.config)("imageUrl",t.imageUrl),e.xp6(3),e.Q6J("ngStyle",e.VKq(54,Z,"url("+t.dataImage+")")),e.xp6(4),e.Q6J("autoZIndex",!1)("baseZIndex",1000001))},directives:[J.O,x.x,d.O5,A.X,_.V,C.Ql,p.JJ,p.On,p.Fj,d.mk,I.p,d.sg,d.PC,y.V2,b.P],styles:[".section-offers[_ngcontent-%COMP%]{max-width:100%!important}.container-cropper[_ngcontent-%COMP%]{max-width:300px}.image2[_ngcontent-%COMP%]{min-width:300px;min-height:300px}.image-miniature[_ngcontent-%COMP%]{min-height:100px;min-width:100px}"]}),i})()}];let j=(()=>{class i{}return i.\u0275fac=function(r){return new(r||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[h.Bz.forChild(k)],h.Bz]}),i})();var L=o(636),w=o(7118),Y=o(7840),z=o(7773),V=o(8478);let R=(()=>{class i{}return i.\u0275fac=function(r){return new(r||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[f.YP],imports:[[d.ez,j,L.p,w.S,Y.C,_.S,p.u5,z.EV,b.n,I.O,V.f,C.Iu,y.dD]]}),i})()}}]);